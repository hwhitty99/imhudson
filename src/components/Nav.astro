---
import { Icon } from 'astro-icon';
import NavItem from './NavItem.astro';
---

<section
    x-data="{ open: false, activePage: window.location.pathname.replaceAll('/','') || 'home', isActive(page) { return page == this.activePage }, hoveredNavItem: window.location.pathname.replaceAll('/','') || 'home', atTop: true }"
    @scroll.window="atTop = !window.scrollY"
>
    <nav
        class="fixed z-10 flex h-auto w-auto flex-col-reverse items-end text-neutral-400 transition-all max-md:bottom-2 max-md:right-2 max-md:rounded-xl max-md:bg-black-900 md:inset-x-0 md:z-10 md:block md:p-4"
        :class="atTop ? 'backdrop-opacity-0' : 'md:backdrop-blur md:bg-black/10'"
    >
        <div class="relative">
            <span
                class="absolute -z-10 h-full rounded-xl bg-white/80 backdrop-blur transition-all duration-200 ease-in-out max-md:hidden"
                :style="{ width: `${$refs[hoveredNavItem]?.offsetWidth || $refs.home.offsetWidth}px`, left: `${$refs[hoveredNavItem]?.offsetLeft || $refs.home.offsetLeft}px` }"
            ></span>
            <div
                x-show="open"
                class="md:mx-auto md:!flex md:!h-auto md:max-w-screen-2xl md:items-center"
                x-collapse
            >
                <a href="/">
                    <Icon name="favicon" class="h-8 max-md:hidden" />
                </a>
                <ul
                    class="left-4 top-4 flex flex-col p-4 text-xl font-semibold max-md:gap-2 max-md:pb-16 md:inset-0 md:!flex md:!h-auto md:w-full md:flex-row md:justify-end md:!overflow-auto md:p-0 md:text-base"
                    role="menubar"
                >
                    <NavItem href="/webdev" page="webdev" />
                    <NavItem href="/film" page="film" />
                    <NavItem href="/free-clout" page="free-clout" />
                    <NavItem href="/" page="home" />
                </ul>
            </div>
        </div>
    </nav>
    <div
        @click="open = !open"
        class="fixed bottom-0 right-0 z-10 flex h-20 w-20 cursor-pointer items-center justify-center md:hidden"
    >
        <Icon
            name="octicon:triangle-up-24"
            class="w-8 transition-transform duration-300"
            :class="open ? 'rotate-180' : 'rotate-0'"
        />
    </div>
</section>
